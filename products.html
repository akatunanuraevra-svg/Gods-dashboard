<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>iBlue | Product Management</title>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Supabase JS v2 -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    /* ===== MOBILE-FIRST RESET ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    :root {
      --primary: #003cff;
      --primary-dark: #0028cc;
      --primary-light: rgba(0, 60, 255, 0.1);
      --success: #28a745;
      --danger: #dc3545;
      --warning: #ffc107;
      --dark: #343a40;
      --gray: #6c757d;
      --light: #f8f9fa;
      --border: #dee2e6;
      --shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
      --radius: 12px;
      --safe-area-top: env(safe-area-inset-top, 0px);
      --safe-area-bottom: env(safe-area-inset-bottom, 0px);
    }

    html {
      font-size: 14px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      min-height: -webkit-fill-available;
      padding: 0;
      line-height: 1.4;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* ===== TOUCH-FRIENDLY ELEMENTS ===== */
    button,
    input,
    select,
    .btn,
    .action-btn {
      min-height: 44px;
      min-width: 44px;
      touch-action: manipulation;
    }

    /* ===== MOBILE HEADER & NAVIGATION ===== */
    .mobile-header {
      background: white;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      z-index: 1000;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      padding: 0 15px;
      padding-top: var(--safe-area-top);
      height: calc(60px + var(--safe-area-top));
    }

    .mobile-header .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      text-decoration: none;
      color: var(--primary);
      font-weight: 800;
      font-size: 1.1rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      flex: 1;
    }

    .mobile-header .logo i {
      font-size: 1.3rem;
      flex-shrink: 0;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .mobile-menu-toggle {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--dark);
      cursor: pointer;
      padding: 8px;
    }

    /* ===== MOBILE SIDEBAR ===== */
    .mobile-sidebar {
      position: fixed;
      top: 0;
      left: -280px;
      width: 100%;
      max-width: 280px;
      height: 100vh;
      height: -webkit-fill-available;
      background: white;
      z-index: 2000;
      padding: calc(80px + var(--safe-area-top)) 20px 20px;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 5px 0 20px rgba(0, 0, 0, 0.1);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
    }

    .mobile-sidebar.active {
      transform: translateX(280px);
    }

    .mobile-nav {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .mobile-nav .nav-link {
      color: var(--dark);
      background: var(--light);
      padding: 15px;
      border-radius: 10px;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 500;
      transition: all 0.3s;
    }

    .mobile-nav .nav-link:hover,
    .mobile-nav .nav-link.active {
      background: var(--primary);
      color: white;
      transform: translateX(5px);
    }

    .mobile-nav .nav-link i {
      width: 20px;
      text-align: center;
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1999;
      display: none;
      backdrop-filter: blur(2px);
    }

    .overlay.active {
      display: block;
    }

    /* ===== ADMIN CONTAINER ===== */
    .admin-container {
      width: 100%;
      background: white;
      overflow: hidden;
      box-shadow: var(--shadow);
      min-height: 100vh;
      min-height: -webkit-fill-available;
      display: flex;
      flex-direction: column;
      margin-top: calc(60px + var(--safe-area-top));
      border-radius: 0;
    }

    /* ===== CONTENT WRAPPER ===== */
    .content-wrapper {
      flex: 1;
      padding: 20px 15px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    /* ===== PAGE HEADER ===== */
    .page-header {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    @media (min-width: 576px) {
      .page-header {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
      }
    }

    .page-title h1 {
      color: var(--dark);
      font-size: 1.5rem;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .page-title h1 i {
      color: var(--primary);
    }

    .page-title p {
      color: var(--gray);
      font-size: 0.9rem;
    }

    /* ===== FILTERS BAR ===== */
    .filters-bar {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 20px;
    }

    @media (min-width: 576px) {
      .filters-bar {
        flex-direction: row;
        align-items: center;
      }
    }

    .search-box {
      position: relative;
      flex: 1;
    }

    .search-box input {
      width: 100%;
      padding: 14px 15px 14px 45px;
      border: 2px solid var(--border);
      border-radius: 10px;
      font-size: 1rem;
      background: white;
      transition: all 0.3s;
    }

    .search-box input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px var(--primary-light);
      outline: none;
    }

    .search-box i {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray);
      pointer-events: none;
    }

    .filter-select {
      padding: 14px 15px;
      border: 2px solid var(--border);
      border-radius: 10px;
      background: white;
      font-size: 1rem;
      color: var(--dark);
      min-width: 150px;
      cursor: pointer;
    }

    .filter-select:focus {
      border-color: var(--primary);
      outline: none;
    }

    /* ===== STATS CARDS ===== */
    .stats-cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .stat-card {
      background: white;
      border-radius: 12px;
      padding: 20px 15px;
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
      gap: 15px;
      transition: transform 0.3s;
      border-left: 4px solid var(--primary);
    }

    .stat-card:active {
      transform: scale(0.98);
    }

    .stat-card.total {
      border-left-color: var(--primary);
    }

    .stat-card.active {
      border-left-color: var(--success);
    }

    .stat-card.inactive {
      border-left-color: var(--danger);
    }

    .stat-card.low-stock {
      border-left-color: var(--warning);
    }

    .stat-icon {
      width: 50px;
      height: 50px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: white;
      flex-shrink: 0;
    }

    .stat-icon.total { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); }
    .stat-icon.active { background: linear-gradient(135deg, var(--success), #1e7e34); }
    .stat-icon.inactive { background: linear-gradient(135deg, var(--danger), #c82333); }
    .stat-icon.low-stock { background: linear-gradient(135deg, var(--warning), #e0a800); }

    .stat-content h3 {
      font-size: 1.5rem;
      margin-bottom: 5px;
      color: var(--dark);
      line-height: 1;
    }

    .stat-content p {
      color: var(--gray);
      font-size: 0.85rem;
    }

    /* ===== PRODUCTS TABLE ===== */
    .table-container {
      background: white;
      border-radius: var(--radius);
      padding: 0;
      box-shadow: var(--shadow);
      overflow: hidden;
      margin-bottom: 20px;
    }

    .table-responsive {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 800px;
    }

    thead {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    }

    th {
      padding: 16px 12px;
      text-align: left;
      color: white;
      font-weight: 600;
      font-size: 0.9rem;
      white-space: nowrap;
    }

    th:first-child {
      padding-left: 20px;
    }

    th:last-child {
      padding-right: 20px;
    }

    tbody tr {
      border-bottom: 1px solid var(--border);
      transition: background 0.3s;
    }

    tbody tr:hover {
      background: var(--primary-light);
    }

    td {
      padding: 16px 12px;
      text-align: left;
      color: var(--dark);
      font-size: 0.9rem;
      vertical-align: middle;
    }

    td:first-child {
      padding-left: 20px;
    }

    td:last-child {
      padding-right: 20px;
    }

    /* ===== PRODUCT INFO ===== */
    .product-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .product-image {
      width: 50px;
      height: 50px;
      border-radius: 8px;
      object-fit: cover;
      flex-shrink: 0;
    }

    .product-details {
      flex: 1;
      min-width: 0;
    }

    .product-name {
      font-weight: 600;
      margin-bottom: 4px;
      color: var(--dark);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .product-sku {
      font-size: 0.8rem;
      color: var(--gray);
    }

    /* ===== STATUS BADGES ===== */
    .status-badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      white-space: nowrap;
    }

    .status-active {
      background: rgba(40, 167, 69, 0.1);
      color: var(--success);
    }

    .status-inactive {
      background: rgba(220, 53, 69, 0.1);
      color: var(--danger);
    }

    .status-low-stock {
      background: rgba(255, 193, 7, 0.1);
      color: #b38b00;
    }

    /* ===== ACTION BUTTONS ===== */
    .action-buttons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .action-btn {
      padding: 8px 12px;
      border: none;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      white-space: nowrap;
    }

    .action-btn:active {
      transform: scale(0.95);
    }

    .btn-edit {
      background: rgba(0, 60, 255, 0.1);
      color: var(--primary);
      border: 1px solid rgba(0, 60, 255, 0.2);
    }

    .btn-edit:hover {
      background: rgba(0, 60, 255, 0.2);
    }

    .btn-delete {
      background: rgba(220, 53, 69, 0.1);
      color: var(--danger);
      border: 1px solid rgba(220, 53, 69, 0.2);
    }

    .btn-delete:hover {
      background: rgba(220, 53, 69, 0.2);
    }

    .btn-toggle {
      background: rgba(40, 167, 69, 0.1);
      color: var(--success);
      border: 1px solid rgba(40, 167, 69, 0.2);
    }

    .btn-toggle.inactive {
      background: rgba(108, 117, 125, 0.1);
      color: var(--gray);
    }

    .btn-toggle:hover {
      background: rgba(40, 167, 69, 0.2);
    }

    /* ===== MOBILE PRODUCT CARDS ===== */
    .mobile-products {
      display: none;
    }

    .product-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      box-shadow: var(--shadow);
      border-left: 4px solid var(--primary);
      transition: transform 0.3s;
    }

    .product-card:active {
      transform: scale(0.98);
    }

    .product-card.active {
      border-left-color: var(--success);
    }

    .product-card.inactive {
      border-left-color: var(--danger);
    }

    .product-card.low-stock {
      border-left-color: var(--warning);
    }

    .product-card-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 15px;
    }

    .product-card-image {
      width: 70px;
      height: 70px;
      border-radius: 10px;
      object-fit: cover;
      flex-shrink: 0;
    }

    .product-card-info {
      flex: 1;
      min-width: 0;
    }

    .product-card-name {
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 5px;
      color: var(--dark);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .product-card-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
    }

    .product-card-meta span {
      font-size: 0.85rem;
      color: var(--gray);
      background: var(--light);
      padding: 4px 8px;
      border-radius: 6px;
    }

    .product-card-details {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border);
    }

    .detail-item {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .detail-label {
      font-size: 0.8rem;
      color: var(--gray);
    }

    .detail-value {
      font-weight: 600;
      color: var(--dark);
      font-size: 0.9rem;
    }

    .product-card-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    /* ===== PAGINATION ===== */
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .page-btn {
      padding: 10px 15px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: white;
      color: var(--dark);
      cursor: pointer;
      font-size: 0.9rem;
      min-width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }

    .page-btn:active {
      transform: scale(0.95);
    }

    .page-btn:hover:not(.active) {
      background: var(--light);
    }

    .page-btn.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .page-btn.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* ===== LOADING STATE ===== */
    .loading {
      display: none;
      justify-content: center;
      align-items: center;
      padding: 40px;
    }

    .loading.active {
      display: flex;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(0, 60, 255, 0.1);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* ===== EMPTY STATE ===== */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--gray);
      grid-column: 1 / -1;
    }

    .empty-state i {
      font-size: 3rem;
      margin-bottom: 20px;
      color: #ddd;
    }

    /* ===== BOTTOM NAVIGATION ===== */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-top: 1px solid var(--border);
      padding: 10px 0;
      z-index: 1000;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-around;
      padding-bottom: calc(10px + var(--safe-area-bottom));
    }

    .bottom-nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      text-decoration: none;
      color: var(--gray);
      font-size: 0.75rem;
      padding: 8px 12px;
      border-radius: 8px;
      transition: all 0.3s;
      min-height: 44px;
      justify-content: center;
    }

    .bottom-nav-item.active {
      color: var(--primary);
      background: var(--primary-light);
    }

    .bottom-nav-item i {
      font-size: 1.2rem;
    }

    /* ===== RESPONSIVE BREAKPOINTS ===== */
    @media (min-width: 480px) {
      html {
        font-size: 15px;
      }
      
      .admin-container {
        border-radius: 12px;
        margin: 20px auto;
        max-width: 100%;
        width: calc(100% - 20px);
        margin-top: calc(80px + var(--safe-area-top));
      }
      
      .content-wrapper {
        padding: 25px 20px;
      }
      
      .stats-cards {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (min-width: 576px) {
      .stats-cards {
        grid-template-columns: repeat(4, 1fr);
      }
      
      .mobile-products {
        display: none !important;
      }
      
      .desktop-table {
        display: block !important;
      }
    }

    @media (min-width: 768px) {
      .mobile-header {
        display: none;
      }
      
      .mobile-sidebar,
      .overlay {
        display: none !important;
      }
      
      .admin-container {
        margin: 30px auto;
        max-width: 1200px;
        margin-top: 30px;
      }
      
      .content-wrapper {
        padding: 30px;
      }
      
      .bottom-nav {
        display: none;
      }
    }

    @media (max-width: 767px) {
      .desktop-table {
        display: none;
      }
      
      .mobile-products {
        display: block;
      }
      
      .table-container {
        padding: 0;
        background: transparent;
        box-shadow: none;
      }
    }

    /* ===== MODAL STYLES ===== */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 3000;
      justify-content: center;
      align-items: center;
      padding: 20px;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
    }

    .modal-content {
      background: white;
      border-radius: 16px;
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal-header {
      padding: 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h3 {
      font-size: 1.3rem;
      color: var(--dark);
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.8rem;
      cursor: pointer;
      color: var(--gray);
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-body {
      padding: 20px;
    }

    .modal-footer {
      padding: 20px;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    /* ===== SWIPE HINT ===== */
    .swipe-hint {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 10px 16px;
      border-radius: 20px;
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 8px;
      z-index: 1001;
      animation: fadeInOut 3s ease-in-out;
      backdrop-filter: blur(10px);
    }

    @keyframes fadeInOut {
      0%, 100% { opacity: 0; }
      10%, 90% { opacity: 1; }
    }

    /* ===== SCROLLBAR ===== */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--light);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--gray);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--dark);
    }
    
    /* ===== TOAST MESSAGES ===== */
    .status-message {
      background: white;
      padding: 15px 20px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 500;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
      max-width: 400px;
      margin-left: auto;
      margin-right: 20px;
    }
    
    .status-message.success {
      border-left: 4px solid var(--success);
      color: var(--success);
    }
    
    .status-message.error {
      border-left: 4px solid var(--danger);
      color: var(--danger);
    }
  </style>
</head>
<body>
  <!-- Mobile Header -->
  <header class="mobile-header">
    <a href="dashboard.html" class="logo">
      <i class="fas fa-arrow-left"></i>
      <span>Product Management</span>
    </a>
    <div class="header-actions">
      <button class="mobile-menu-toggle" onclick="toggleSidebar()" aria-label="Menu">
        <i class="fas fa-bars"></i>
      </button>
    </div>
  </header>

  <!-- Mobile Sidebar -->
  <nav class="mobile-sidebar" id="mobileSidebar">
    <div class="mobile-nav">
      <a href="dashboard.html" class="nav-link">
        <i class="fas fa-tachometer-alt"></i> Dashboard
      </a>
      <a href="admin-add-products.html" class="nav-link">
        <i class="fas fa-plus-circle"></i> Add Product
      </a>
      <a href="#" class="nav-link active">
        <i class="fas fa-boxes"></i> Manage Products
      </a>
      <a href="categories.html" class="nav-link">
        <i class="fas fa-tags"></i> Categories
      </a>
      <a href="inventory.html" class="nav-link">
        <i class="fas fa-warehouse"></i> Inventory
      </a>
      <a href="#" onclick="logout()" class="nav-link">
        <i class="fas fa-sign-out-alt"></i> Logout
      </a>
    </div>
  </nav>
  <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

  <!-- Bottom Navigation for Mobile -->
  <div class="bottom-nav">
    <a href="dashboard.html" class="bottom-nav-item">
      <i class="fas fa-tachometer-alt"></i>
      <span>Dashboard</span>
    </a>
    <a href="admin-add-products.html" class="bottom-nav-item">
      <i class="fas fa-plus-circle"></i>
      <span>Add</span>
    </a>
    <a href="#" class="bottom-nav-item active">
      <i class="fas fa-boxes"></i>
      <span>Products</span>
    </a>
    <a href="orders.html" class="bottom-nav-item">
      <i class="fas fa-shopping-cart"></i>
      <span>Orders</span>
    </a>
  </div>

  <!-- Admin Container -->
  <main class="admin-container">
    <div class="content-wrapper">
      <!-- Page Header -->
      <div class="page-header">
        <div class="page-title">
          <h1><i class="fas fa-boxes"></i> Product Management</h1>
          <p>Manage your product catalog, inventory, and pricing</p>
        </div>
        <div>
          <a href="admin-add-products.html" class="action-btn btn-edit" style="padding: 12px 20px;">
            <i class="fas fa-plus"></i> Add New Product
          </a>
        </div>
      </div>

      <!-- Stats Cards -->
      <div class="stats-cards" id="statsCards">
        <div class="stat-card total">
          <div class="stat-icon total">
            <i class="fas fa-box"></i>
          </div>
          <div class="stat-content">
            <h3 id="totalProducts">0</h3>
            <p>Total Products</p>
          </div>
        </div>
        <div class="stat-card active">
          <div class="stat-icon active">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="stat-content">
            <h3 id="activeProducts">0</h3>
            <p>Active Products</p>
          </div>
        </div>
        <div class="stat-card inactive">
          <div class="stat-icon inactive">
            <i class="fas fa-times-circle"></i>
          </div>
          <div class="stat-content">
            <h3 id="inactiveProducts">0</h3>
            <p>Inactive Products</p>
          </div>
        </div>
        <div class="stat-card low-stock">
          <div class="stat-icon low-stock">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <div class="stat-content">
            <h3 id="lowStockProducts">0</h3>
            <p>Low Stock</p>
          </div>
        </div>
      </div>

      <!-- Filters Bar -->
      <div class="filters-bar">
        <div class="search-box">
          <i class="fas fa-search"></i>
          <input type="text" id="searchInput" placeholder="Search products by name, SKU, or category..." oninput="searchProducts()">
        </div>
        <div>
          <select class="filter-select" id="statusFilter" onchange="filterProducts()">
            <option value="">All Status</option>
            <option value="active">Active Only</option>
            <option value="inactive">Inactive Only</option>
          </select>
        </div>
        <div>
          <select class="filter-select" id="stockFilter" onchange="filterProducts()">
            <option value="">All Stock</option>
            <option value="low">Low Stock (≤ 5)</option>
            <option value="out">Out of Stock</option>
            <option value="in">In Stock</option>
          </select>
        </div>
      </div>

      <!-- Loading State -->
      <div class="loading" id="loading">
        <div class="spinner"></div>
        <span>Loading products...</span>
      </div>

      <!-- Desktop Table View -->
      <div class="table-container desktop-table">
        <div class="table-responsive">
          <table>
            <thead>
              <tr>
                <th>Product</th>
                <th>Price</th>
                <th>Stock</th>
                <th>Category</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="productsTableBody">
              <!-- Products will be loaded from Supabase -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Mobile Products View -->
      <div class="mobile-products" id="mobileProducts">
        <!-- Product cards will be loaded from Supabase -->
      </div>

      <!-- Pagination -->
      <div class="pagination" id="pagination">
        <!-- Pagination buttons will be loaded dynamically -->
      </div>

      <!-- Empty State -->
      <div class="empty-state" id="emptyState" style="display: none;">
        <i class="fas fa-box-open"></i>
        <h3>No Products Found</h3>
        <p>Add your first product to get started</p>
        <a href="admin-add-products.html" class="action-btn btn-edit" style="margin-top: 20px; display: inline-block;">
          <i class="fas fa-plus"></i> Add New Product
        </a>
      </div>
    </div>
  </main>

  <!-- Delete Confirmation Modal -->
  <div class="modal" id="deleteModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Confirm Deactivation</h3>
        <button class="modal-close" onclick="closeModal('deleteModal')">&times;</button>
      </div>
      <div class="modal-body">
        <p id="deleteMessage">Are you sure you want to deactivate this product? The product will be hidden from customers but preserved in the database.</p>
      </div>
      <div class="modal-footer">
        <button class="action-btn btn-edit" onclick="closeModal('deleteModal')">Cancel</button>
        <button class="action-btn btn-delete" onclick="confirmDelete()">Deactivate Product</button>
      </div>
    </div>
  </div>

  <!-- Swipe Hint -->
  <div class="swipe-hint" id="swipeHint">
    <i class="fas fa-hand-point-up"></i>
    <span>Swipe left/right to see more details</span>
  </div>

  <script>
    // Initialize Supabase client
    const SUPABASE_URL = "https://amxhpxqakqrjjihwkzcq.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFteGhweHFha3FyamppaHdremNxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc5Nzc2NjUsImV4cCI6MjA4MzU1MzY2NX0.yIAZtz3bUc_ZxF8-f4cqW1fKJgFiRsiJdj4qgCDmM0g";

    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Global variables
    let allProducts = [];
    let currentPage = 1;
    const productsPerPage = 10;
    let currentProductId = null;
    let searchTimeout = null;
    let currentUser = null;

    // DOM Elements
    const productsTableBody = document.getElementById('productsTableBody');
    const mobileProducts = document.getElementById('mobileProducts');
    const loading = document.getElementById('loading');
    const emptyState = document.getElementById('emptyState');
    const pagination = document.getElementById('pagination');
    const totalProductsEl = document.getElementById('totalProducts');
    const activeProductsEl = document.getElementById('activeProducts');
    const inactiveProductsEl = document.getElementById('inactiveProducts');
    const lowStockProductsEl = document.getElementById('lowStockProducts');
    const searchInput = document.getElementById('searchInput');
    const statusFilter = document.getElementById('statusFilter');
    const stockFilter = document.getElementById('stockFilter');
    const swipeHint = document.getElementById('swipeHint');

    // Helper function to safely get product image
    function getProductImage(product) {
      try {
        // Check if images field exists and is not null
        if (product.images) {
          // If images is a string, try to parse it as JSON
          if (typeof product.images === 'string') {
            try {
              const parsedImages = JSON.parse(product.images);
              if (Array.isArray(parsedImages) && parsedImages.length > 0) {
                const firstImage = parsedImages[0];
                // Check if it's an object with url property
                return (typeof firstImage === 'object' && firstImage.url) 
                  ? firstImage.url 
                  : firstImage;
              }
            } catch (e) {
              // If parsing fails, it might be a single URL string
              return product.images;
            }
          }
          // If images is already an array
          else if (Array.isArray(product.images) && product.images.length > 0) {
            const firstImage = product.images[0];
            return (typeof firstImage === 'object' && firstImage.url) 
              ? firstImage.url 
              : firstImage;
          }
        }
        
        // Fallback to image_url field
        if (product.image_url) return product.image_url;
        
        // Default placeholder
        return 'https://via.placeholder.com/70';
      } catch (error) {
        console.error('Error getting product image:', error);
        return 'https://via.placeholder.com/70';
      }
    }

    // Helper function to format UGX currency
    function formatUGX(amount) {
      return new Intl.NumberFormat('en-UG', {
        style: 'currency',
        currency: 'UGX',
        minimumFractionDigits: 0,
        maximumFractionDigits: 0
      }).format(amount || 0);
    }

    // Escape HTML to prevent XSS
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', async function() {
      // Check authentication
      await checkAuth();
      
      // Show swipe hint on first visit
      if (!localStorage.getItem('productsHintShown')) {
        setTimeout(() => {
          swipeHint.style.display = 'flex';
          setTimeout(() => {
            swipeHint.style.display = 'none';
          }, 3000);
        }, 1000);
        localStorage.setItem('productsHintShown', 'true');
      }
      
      loadProducts();
      
      // Check for active filters in URL
      const urlParams = new URLSearchParams(window.location.search);
      const status = urlParams.get('status');
      const stock = urlParams.get('stock');
      const search = urlParams.get('search');
      
      if (status) statusFilter.value = status;
      if (stock) stockFilter.value = stock;
      if (search) {
        searchInput.value = search;
        filterProducts();
      }
    });

    // Check authentication
    async function checkAuth() {
      try {
        const { data: { session } } = await sb.auth.getSession();
        
        if (!session) {
          window.location.href = 'admin-login.html';
          return;
        }
        
        // Check in user_profiles table
        const { data: profile, error: profileError } = await sb
          .from('user_profiles')
          .select('id, account_type, first_name, username')
          .eq('id', session.user.id)
          .single();
        
        // Check in admins table
        const { data: adminProfile, error: adminError } = await sb
          .from('admins')
          .select('id, email')
          .eq('id', session.user.id)
          .single();
        
        // Allow access if admin or seller
        const isAdmin = adminProfile || 
          (profile && (profile.account_type === 'admin' || profile.account_type === 'seller'));
        
        if (!isAdmin) {
          alert('You do not have permission to access this page. Admin/seller privileges required.');
          window.location.href = 'admin-login.html';
          return;
        }
        
        currentUser = {
          id: session.user.id,
          email: session.user.email,
          profile: profile || adminProfile
        };
        
      } catch (error) {
        console.error('Auth error:', error);
        alert('Authentication error. Please login again.');
        window.location.href = 'admin-login.html';
      }
    }

    // Toggle mobile sidebar
    window.toggleSidebar = function() {
      const mobileSidebar = document.getElementById('mobileSidebar');
      const overlay = document.getElementById('overlay');
      mobileSidebar.classList.toggle('active');
      overlay.classList.toggle('active');
      document.body.style.overflow = mobileSidebar.classList.contains('active') ? 'hidden' : '';
    };

    // Close sidebar when clicking outside
    document.addEventListener('click', function(event) {
      const mobileSidebar = document.getElementById('mobileSidebar');
      const menuToggle = document.querySelector('.mobile-menu-toggle');
      
      if (window.innerWidth <= 768 && 
          mobileSidebar && menuToggle &&
          !mobileSidebar.contains(event.target) && 
          !menuToggle.contains(event.target) &&
          mobileSidebar.classList.contains('active')) {
        toggleSidebar();
      }
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
      // Escape to close sidebar/modals
      if (e.key === 'Escape') {
        const mobileSidebar = document.getElementById('mobileSidebar');
        if (mobileSidebar && mobileSidebar.classList.contains('active')) {
          toggleSidebar();
        }
        
        const deleteModal = document.getElementById('deleteModal');
        if (deleteModal.style.display === 'flex') {
          closeModal('deleteModal');
        }
      }
      
      // Ctrl/Cmd + F to focus search
      if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
        e.preventDefault();
        searchInput.focus();
      }
      
      // F5 to refresh
      if (e.key === 'F5') {
        e.preventDefault();
        loadProducts();
      }
    });

    // Load products from Supabase - CORRECTED TABLE NAME
    async function loadProducts() {
      loading.classList.add('active');
      productsTableBody.innerHTML = '';
      mobileProducts.innerHTML = '';
      
      try {
        // Query products_new table (matches your schema)
        const { data, error } = await sb
          .from('products_new')
          .select('*')
          .order('created_at', { ascending: false });
        
        if (error) throw error;
        
        allProducts = data || [];
        updateStats(allProducts);
        
        if (allProducts.length === 0) {
          showEmptyState();
        } else {
          emptyState.style.display = 'none';
          filterProducts();
        }
        
      } catch (error) {
        console.error('Error loading products:', error);
        showMessage(`Error loading products: ${error.message}`, 'error');
        showEmptyState();
      } finally {
        loading.classList.remove('active');
      }
    }

    // Update statistics
    function updateStats(products) {
      const total = products.length;
      const active = products.filter(p => p.active).length;
      const inactive = products.filter(p => !p.active).length;
      const lowStock = products.filter(p => p.stock_quantity <= 5).length;
      
      totalProductsEl.textContent = total.toLocaleString();
      activeProductsEl.textContent = active.toLocaleString();
      inactiveProductsEl.textContent = inactive.toLocaleString();
      lowStockProductsEl.textContent = lowStock.toLocaleString();
    }

    // Filter and display products
    function filterProducts() {
      let filtered = [...allProducts];
      
      // Apply search filter
      const searchTerm = searchInput.value.toLowerCase();
      if (searchTerm) {
        filtered = filtered.filter(product => 
          product.name.toLowerCase().includes(searchTerm) ||
          (product.sku && product.sku.toLowerCase().includes(searchTerm)) ||
          (product.category && product.category.toLowerCase().includes(searchTerm)) ||
          (product.brand && product.brand.toLowerCase().includes(searchTerm))
        );
      }
      
      // Apply status filter
      const status = statusFilter.value;
      if (status === 'active') {
        filtered = filtered.filter(p => p.active);
      } else if (status === 'inactive') {
        filtered = filtered.filter(p => !p.active);
      }
      
      // Apply stock filter
      const stock = stockFilter.value;
      if (stock === 'low') {
        filtered = filtered.filter(p => p.stock_quantity <= 5);
      } else if (stock === 'out') {
        filtered = filtered.filter(p => p.stock_quantity === 0);
      } else if (stock === 'in') {
        filtered = filtered.filter(p => p.stock_quantity > 0);
      }
      
      // Update URL with current filters
      updateURLWithFilters();
      
      // Update stats for filtered results
      updateStats(filtered);
      
      // Check if empty after filtering
      if (filtered.length === 0) {
        showEmptyState();
        return;
      }
      
      // Display products
      displayProducts(filtered);
      updatePagination(filtered.length);
    }

    // Update URL with current filters
    function updateURLWithFilters() {
      const params = new URLSearchParams();
      
      if (searchInput.value) params.set('search', searchInput.value);
      if (statusFilter.value) params.set('status', statusFilter.value);
      if (stockFilter.value) params.set('stock', stockFilter.value);
      
      const newUrl = `${window.location.pathname}${params.toString() ? '?' + params.toString() : ''}`;
      window.history.replaceState({}, '', newUrl);
    }

    // Search products with debounce
    function searchProducts() {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        filterProducts();
        currentPage = 1;
      }, 300);
    }

    // Display products in table and cards
    function displayProducts(products) {
      // Calculate pagination
      const startIndex = (currentPage - 1) * productsPerPage;
      const endIndex = startIndex + productsPerPage;
      const pageProducts = products.slice(startIndex, endIndex);
      
      // Clear existing content
      productsTableBody.innerHTML = '';
      mobileProducts.innerHTML = '';
      
      // Display desktop table
      pageProducts.forEach(product => {
        const row = document.createElement('tr');
        
        // Determine status and stock classes
        const statusClass = product.active ? 'status-active' : 'status-inactive';
        const statusText = product.active ? 'Active' : 'Inactive';
        const stockClass = product.stock_quantity <= 5 ? 'status-low-stock' : '';
        const stockText = product.stock_quantity > 0 ? 
          `${product.stock_quantity} units` : 'Out of stock';
        
        // Get safe image URL
        const productImage = getProductImage(product);
        
        row.innerHTML = `
          <td>
            <div class="product-info">
              <img src="${productImage}" 
                   alt="${product.name}" 
                   class="product-image"
                   onerror="this.src='https://via.placeholder.com/50'">
              <div class="product-details">
                <div class="product-name">${escapeHtml(product.name)}</div>
                <div class="product-sku">${product.sku || 'No SKU'}</div>
              </div>
            </div>
          </td>
          <td>
            <div style="font-weight: 600; color: var(--dark);">
              ${formatUGX(product.price || 0)}
            </div>
            ${product.discount_price ? `
              <div style="font-size: 0.8rem; color: var(--danger); text-decoration: line-through;">
                ${formatUGX(product.discount_price)}
              </div>
            ` : ''}
          </td>
          <td>
            <span class="status-badge ${stockClass}">${stockText}</span>
          </td>
          <td>${product.category || 'Uncategorized'}</td>
          <td>
            <span class="status-badge ${statusClass}">${statusText}</span>
            ${product.featured ? '<br><small style="color: var(--warning);">⭐ Featured</small>' : ''}
          </td>
          <td>
            <div class="action-buttons">
              <button class="action-btn btn-toggle ${product.active ? '' : 'inactive'}" 
                      onclick="toggleActive('${product.id}', ${product.active})"
                      aria-label="${product.active ? 'Deactivate' : 'Activate'} product">
                <i class="fas ${product.active ? 'fa-toggle-on' : 'fa-toggle-off'}"></i>
                ${product.active ? 'Deactivate' : 'Activate'}
              </button>
              <a href="edit-product.html?id=${product.id}" class="action-btn btn-edit">
                <i class="fas fa-edit"></i>
                Edit
              </a>
              <button class="action-btn btn-delete" 
                      onclick="showDeleteModal('${product.id}', '${escapeHtml(product.name)}')"
                      aria-label="Deactivate product">
                <i class="fas fa-trash"></i>
                Deactivate
              </button>
            </div>
          </td>
        `;
        productsTableBody.appendChild(row);
      });
      
      // Display mobile cards
      if (window.innerWidth <= 767) {
        pageProducts.forEach(product => {
          const card = document.createElement('div');
          card.className = `product-card ${product.active ? 'active' : 'inactive'} ${product.stock_quantity <= 5 ? 'low-stock' : ''}`;
          
          // Get safe image URL
          const productImage = getProductImage(product);
          
          card.innerHTML = `
            <div class="product-card-header">
              <img src="${productImage}" 
                   alt="${product.name}" 
                   class="product-card-image"
                   onerror="this.src='https://via.placeholder.com/70'">
              <div class="product-card-info">
                <div class="product-card-name">${escapeHtml(product.name)}</div>
                <div class="product-card-meta">
                  ${product.sku ? `<span>SKU: ${product.sku}</span>` : ''}
                  ${product.category ? `<span>${product.category}</span>` : ''}
                  ${product.featured ? `<span>⭐ Featured</span>` : ''}
                </div>
              </div>
            </div>
            
            <div class="product-card-details">
              <div class="detail-item">
                <span class="detail-label">Price</span>
                <span class="detail-value">${formatUGX(product.price || 0)}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Stock</span>
                <span class="detail-value ${product.stock_quantity <= 5 ? 'status-low-stock' : ''}">
                  ${product.stock_quantity > 0 ? `${product.stock_quantity} units` : 'Out of stock'}
                </span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Status</span>
                <span class="detail-value ${product.active ? 'status-active' : 'status-inactive'}">
                  ${product.active ? 'Active' : 'Inactive'}
                </span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Category</span>
                <span class="detail-value">${product.category || '—'}</span>
              </div>
            </div>
            
            <div class="product-card-actions">
              <button class="action-btn btn-toggle ${product.active ? '' : 'inactive'}" 
                      onclick="toggleActive('${product.id}', ${product.active})"
                      style="flex: 1;">
                <i class="fas ${product.active ? 'fa-toggle-on' : 'fa-toggle-off'}"></i>
                ${product.active ? 'Deactivate' : 'Activate'}
              </button>
              <a href="edit-product.html?id=${product.id}" class="action-btn btn-edit" style="flex: 1;">
                <i class="fas fa-edit"></i>
                Edit
              </a>
              <button class="action-btn btn-delete" 
                      onclick="showDeleteModal('${product.id}', '${escapeHtml(product.name)}')"
                      style="flex: 1;">
                <i class="fas fa-trash"></i>
                Deactivate
              </button>
            </div>
          `;
          mobileProducts.appendChild(card);
        });
      }
    }

    // Show empty state
    function showEmptyState() {
      productsTableBody.innerHTML = '';
      mobileProducts.innerHTML = '';
      pagination.innerHTML = '';
      emptyState.style.display = 'block';
    }

    // Update pagination
    function updatePagination(totalProducts) {
      pagination.innerHTML = '';
      const totalPages = Math.ceil(totalProducts / productsPerPage);
      
      if (totalPages <= 1) return;
      
      // Previous button
      if (currentPage > 1) {
        const prevBtn = document.createElement('button');
        prevBtn.className = 'page-btn';
        prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
        prevBtn.onclick = () => {
          currentPage--;
          filterProducts();
          window.scrollTo({ top: 0, behavior: 'smooth' });
        };
        pagination.appendChild(prevBtn);
      }
      
      // Page numbers
      for (let i = 1; i <= totalPages; i++) {
        if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
          const pageBtn = document.createElement('button');
          pageBtn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
          pageBtn.textContent = i;
          pageBtn.onclick = () => {
            currentPage = i;
            filterProducts();
            window.scrollTo({ top: 0, behavior: 'smooth' });
          };
          pagination.appendChild(pageBtn);
        } else if (i === currentPage - 2 || i === currentPage + 2) {
          const ellipsis = document.createElement('span');
          ellipsis.textContent = '...';
          ellipsis.style.padding = '10px';
          ellipsis.style.color = 'var(--gray)';
          pagination.appendChild(ellipsis);
        }
      }
      
      // Next button
      if (currentPage < totalPages) {
        const nextBtn = document.createElement('button');
        nextBtn.className = 'page-btn';
        nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
        nextBtn.onclick = () => {
          currentPage++;
          filterProducts();
          window.scrollTo({ top: 0, behavior: 'smooth' });
        };
        pagination.appendChild(nextBtn);
      }
    }

    // Toggle product active status
    async function toggleActive(id, currentStatus) {
      try {
        const { error } = await sb
          .from('products_new')
          .update({ 
            active: !currentStatus,
            is_active: !currentStatus,
            updated_at: new Date().toISOString()
          })
          .eq('id', id);
        
        if (error) throw error;
        
        // Update local data
        const productIndex = allProducts.findIndex(p => p.id === id);
        if (productIndex !== -1) {
          allProducts[productIndex].active = !currentStatus;
          allProducts[productIndex].is_active = !currentStatus;
          allProducts[productIndex].updated_at = new Date().toISOString();
        }
        
        // Show success message
        showMessage(`Product ${!currentStatus ? 'activated' : 'deactivated'} successfully!`, 'success');
        
        // Refresh display
        filterProducts();
        
      } catch (error) {
        console.error('Error toggling product status:', error);
        showMessage(`Error: ${error.message}`, 'error');
      }
    }

    // Show delete confirmation modal
    function showDeleteModal(id, productName) {
      currentProductId = id;
      const deleteMessage = document.getElementById('deleteMessage');
      deleteMessage.textContent = `Are you sure you want to deactivate "${productName}"? The product will be hidden from customers but preserved in the database.`;
      openModal('deleteModal');
    }

    // Deactivate product (soft delete)
    async function deactivateProduct(id) {
      try {
        const { error } = await sb
          .from('products_new')
          .update({ 
            active: false,
            is_active: false,
            deleted_at: new Date().toISOString(),
            updated_at: new Date().toISOString()
          })
          .eq('id', id);
        
        if (error) throw error;
        
        // Update local data
        const productIndex = allProducts.findIndex(p => p.id === id);
        if (productIndex !== -1) {
          allProducts[productIndex].active = false;
          allProducts[productIndex].is_active = false;
          allProducts[productIndex].deleted_at = new Date().toISOString();
        }
        
        // Show success message
        showMessage('Product deactivated successfully!', 'success');
        
        // Refresh display
        filterProducts();
        
        // Close modal
        closeModal('deleteModal');
        
      } catch (error) {
        console.error('Error deactivating product:', error);
        showMessage(`Error: ${error.message}`, 'error');
        closeModal('deleteModal');
      }
    }

    // Confirm deactivation from modal
    function confirmDelete() {
      if (currentProductId) {
        deactivateProduct(currentProductId);
      }
    }

    // Modal functions
    function openModal(modalId) {
      document.getElementById(modalId).style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }

    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
      document.body.style.overflow = '';
      currentProductId = null;
    }

    // Show toast message
    function showMessage(text, type) {
      // Create toast message
      const toast = document.createElement('div');
      toast.className = `status-message ${type}`;
      toast.style.position = 'fixed';
      toast.style.top = '20px';
      toast.style.right = '20px';
      toast.style.left = '20px';
      toast.style.zIndex = '4000';
      toast.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
      toast.style.maxWidth = 'calc(100% - 40px)';
      toast.innerHTML = `
        <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
        <span>${text}</span>
      `;
      
      document.body.appendChild(toast);
      
      // Remove after 3 seconds
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateY(-10px)';
        setTimeout(() => {
          if (toast.parentNode) {
            toast.parentNode.removeChild(toast);
          }
        }, 300);
      }, 3000);
    }

    // Logout function
    window.logout = async function() {
      if (confirm('Are you sure you want to logout?')) {
        await sb.auth.signOut();
        window.location.href = 'admin-login.html';
      }
    };

    // Handle window resize
    window.addEventListener('resize', function() {
      if (window.innerWidth > 768) {
        const mobileSidebar = document.getElementById('mobileSidebar');
        if (mobileSidebar && mobileSidebar.classList.contains('active')) {
          toggleSidebar();
        }
      }
      
      // Refresh display on orientation change
      if (allProducts.length > 0) {
        filterProducts();
      }
    });

    // Handle swipe gestures on mobile
    if ('ontouchstart' in window) {
      let touchStartX = 0;
      let touchEndX = 0;
      
      document.addEventListener('touchstart', e => {
        touchStartX = e.changedTouches[0].screenX;
      });
      
      document.addEventListener('touchend', e => {
        touchEndX = e.changedTouches[0].screenX;
        handleSwipe();
      });
      
      function handleSwipe() {
        const swipeThreshold = 50;
        const swipeDistance = touchEndX - touchStartX;
        
        // Right swipe (go back)
        if (swipeDistance > swipeThreshold) {
          window.history.back();
        }
      }
    }

    // Add refresh button functionality
    window.addEventListener('load', function() {
      // Add a refresh button in the header on desktop
      if (window.innerWidth > 768) {
        const pageHeader = document.querySelector('.page-header div:last-child');
        if (pageHeader) {
          const refreshBtn = document.createElement('button');
          refreshBtn.className = 'action-btn btn-edit';
          refreshBtn.style.marginLeft = '10px';
          refreshBtn.style.padding = '12px 20px';
          refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh';
          refreshBtn.onclick = loadProducts;
          pageHeader.appendChild(refreshBtn);
        }
      }
    });
  </script>
</body>
</html>